# 書籍貸出機能拡張計画 (v3)

## 概要

`main_menu.html` アプリケーションに、以下の手順で「貸出」ボタンの機能を実装します。

1.  **ボタンクリックイベント:** `main_menu.html` の「貸出」ボタンをクリックすると、すぐに `main_menu.html` のインターフェースを非表示にします。

2.  **NFCプロンプトの表示:** `/static/images/IDCardTouchRequest.jpg` (PaSoRi NFCリーダーに社員証をタップするように指示する画像) を画面中央に表示します。画像がさまざまな画面解像度に合わせて適切にサイズ調整およびスケーリングされるようにします。

3.  **NFCカードリーダーの統合 (`nfcpy`):** `nfcpy` ライブラリを使用して、PaSoRi NFCリーダーから従業員IDカードのデータを読み取ります。具体的には以下を行います。
    *   **データ抽出:** C++コードの参照と`/NFCsamples/mine.txt`ファイルの分析に基づいて、正しいメモリ位置から10桁の従業員IDと可変長のカタカナ氏名を抽出します。
        *   従業員ID: `sys_cd1 = { 0xfe, 0x00 }`, `svc_cd1 = { 0xcb, 0x51 }`, `blk_lst1 = { 0x80, 0x00 }`
        *   カタカナ氏名: `sys_cd1 = { 0xfe, 0x00 }`, `svc_cd1 = { 0xcb, 0x51 }`, `blk_lst1 = { 0x80, 0x00 }`
    *   **エンコーディング処理:** カタカナ氏名の文字エンコーディングを適切に処理して、正しく表示および保存されるようにします。
    *   **エラー処理:** NFCリーダーの通信エラー、カード検出の問題、およびデータ読み取りエラーに対する包括的なエラー処理を実装します。すべてのエラーをログに記録します。

4.  **データ取得の成功:** 10桁の従業員IDとカタカナ氏名の両方が正常に読み取られた場合、NFCプロンプトを非表示にし、取得した社員番号と半角カナ氏名をコンソールに出力します。

5.  **タイムアウトとエラー処理:** 20秒以内に従業員IDを読み取ることができない場合は、エラーメッセージ "社員証が検出されませんでした。" を表示し、`main_menu.html` インターフェースに戻ります。カタカナ氏名がカードに存在しない場合は、適切に処理します。氏名がない場合は、デフォルト値または適切なメッセージを表示します。

6.  **ドライバの互換性:** 既存のSony PaSoRiドライバと`nfcpy`の互換性を確認します。必要に応じて、最適なパフォーマンスと信頼性を実現するために必要な追加または代替ドライバを特定してインストールします。ドライバのインストールプロセスを文書化します。

7.  **ユーザーエクスペリエンス:** プロセス全体を通して、スムーズで直感的なユーザーエクスペリエンスを優先します。各ステップで、明確で簡潔な指示をユーザーに提供します。

8.  **セキュリティに関する考慮事項:** 従業員IDデータの読み取りと保存に関する潜在的なセキュリティ上の影響を考慮します。機密情報を保護するための適切な対策を実施します。

## 今後のステップ

*   上記計画を元に、`app.py` と `static/js/navigation.js` を修正し、機能を実装します。
*   `nfcpy` ライブラリのインストール、PaSoRi NFCリーダーとの接続、データの読み取り、エラー処理、UIの更新などを行います。